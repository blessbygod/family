define("http://127.0.0.1:3000/javascripts/main/main",[],function(a){a("plugins/jquery.togglelist");for(var b=[],c=[],d=0;15e4>d;d++)b.push({email:"email_"+d+"@domain_"+d+".com",id:"id_"+d,text:"id_"+d+" &lt;"+"email_"+d+"@domain_"+d+".com"+"&gt;"});for(d=0;10>d;d++)c.push({email:"email_"+d+"@domain_"+d+".com",text:"id_"+d+" &lt;"+"email_"+d+"@domain_"+d+".com"+"&gt;",id:"id_"+d});$("#toggle_list_content").togglelist({from_list:b,to_list:c})}),define("http://127.0.0.1:3000/javascripts/plugins/jquery.pagination",[],function(){$.fn.pagination=function(a){var b=$(this),c=this,d=['<ul class="<%= paginationULClass %>">','<li class="<%= preAllClass %>">','<a href="javascript:;"><%= _.isArray(paginationTextArr) ? paginationTextArr[0] : "" %></a>',"</li>",'<li class="<%= preOneClass %>">','<a href="javascript:;"><%= _.isArray(paginationTextArr) ? paginationTextArr[1] : "" %></a>',"</li>",'<li class="<%= paginationSelectContainerClass %>">','<select class="pagination-select span1" value="<%= current %>">',"<% for(var i=1; i <= pages; i++){ %>",'<option value="<%= i %>"><%= i %></option>',"<% } %>","</select>","</li>",'<li class="<%= nextOneClass %>">','<a href="javascript:;"><%= _.isArray(paginationTextArr) ? paginationTextArr[2] : "" %></a>',"</li>",'<li class="<%= nextAllClass %>">','<a href="javascript:;"><%= _.isArray(paginationTextArr) ? paginationTextArr[3] : "" %></a>',"</li>","</ul>"].join("");return this.initConfig=function(){a=_.extend({count:0,current:1,page_count:8,layout:"center",paginationTextArr:["<<","<",">",">>"],paginationULClass:"page_nav",preAllClass:"pre-all",preOneClass:"pre-one",nextOneClass:"next-one",nextAllClass:"next-all",isSameDisabled:!0,disabledClassDashline:"_",disabledClass:"disabled",paginationSelectContainerClass:"page_numa",template:d,callback:function(){}},a),this.options=a},this.initialize=function(){this.initConfig(),this.render()},this.render=function(){if(_.isNumber(a.count)){a.pages=Math.ceil(a.count/a.page_count)||1;var c=_.template(a.template,_.extend(a,{pages:a.pages,current:a.current}));b.html(c),this.$select=b.find(".pagination-select"),this.$select.val(a.current),this.renderActionStatus(),this.bindEvents()}},this.renderActionStatus=function(){a.pages=Math.ceil(a.count/a.page_count);var c=parseInt(this.$select.val(),10),d=a.disabledClass,e=a.isSameDisabled?d:a.preAllClass+a.disabledClassDashline+d,f=a.isSameDisabled?d:a.preOneClass+a.disabledClassDashline+d,g=a.isSameDisabled?d:a.nextOneClass+a.disabledClassDashline+d,h=a.isSameDisabled?d:a.nextAllClass+a.disabledClassDashline+d;1===c?(b.find("."+a.preAllClass).addClass(e),b.find("."+a.preOneClass).addClass(f)):(b.find("."+a.preAllClass).removeClass(e),b.find("."+a.preOneClass).removeClass(f)),c>=a.pages?(b.find("."+a.nextAllClass).addClass(h),b.find("."+a.nextOneClass).addClass(g)):(b.find("."+a.nextAllClass).removeClass(h),b.find("."+a.nextOneClass).removeClass(g))},this.bindEvents=function(){b.off("click"),this.$select.off("change"),this.$select.on("change",function(){c.renderActionStatus()});var d=["."+a.preOneClass,"."+a.preAllClass,"."+a.nextOneClass,"."+a.nextAllClass].join();b.on("click",d,function(b){var d=$(b.currentTarget);if(!(d.attr("class").indexOf(a.disabledClass)>-1)){if(d.hasClass(a.preOneClass)){if(1===a.current)return;a.current=a.current-1}else if(d.hasClass(a.nextOneClass)){if(a.current===a.pages)return;a.current=a.current+1}else d.hasClass(a.preAllClass)?a.current=1:d.hasClass(a.nextAllClass)&&(a.current=a.pages);c.$select.val(a.current),c.renderActionStatus(),a.callback&&a.callback()}})},this.initialize(),this}}),define("http://127.0.0.1:3000/javascripts/plugins/jquery.togglelist",[],function(a){a("plugins/jquery.pagination"),$.fn.togglelist=function(a){var b=$(this),c=this;this.timer=null;var d=['<div class="from_list_container">','<div class="title">',"<span><%= from_list_title %></span>",'<i class="sort-query icon-download pull-right" data-sort="asc"></i>',"</div>",'<div class="search">','<input class="<%= search_input_class %>" placeholder="<%= search_text %>" />',"</div>",'<div class="list_container">','<ul class="from_list">',"</ul>","</div>",'<div class="bottom">','<div class="pagination">',"</div>",'<div class="toggle_all_page status_class_1">',"<%= add_all_page %>","</div>",'<div class="toggle_current_page status_class_1">',"<%= add_current_page %>","</div>","</div>","</div>",'<div class="action_area">',"</div>",'<div class="to_list_container">','<div class="title">',"<span><%= to_list_title %></span>",'<i class="sort-query icon-download pull-right" data-sort="asc"></i>',"</div>",'<div class="search">','<input class="<%= search_input_class %>" placeholder="<%= search_text %>" />',"</div>",'<div class="list_container">','<ul class="to_list">',"</ul>","</div>",'<div class="bottom">','<div class="pagination">',"</div>",'<div class="delete_all_page status_class_1">',"<%= delete_all_page %>","</div>",'<div class="delete_current_page status_class_1">',"<%= delete_current_page %>","</div>","</div>","</div>"].join("");return this.initialize=function(){this.initConfig(),this.initListStatusHash(),this.render(),this.bindEvents()},this.initConfig=function(){a=_.extend({from_list:[],to_list:[],itemId:"id",itemText:"text",status_text_1:"添加",status_text_2:"已添加",status_class_1:"status_class_1",status_class_2:"status_class_2",page_count:12,template:d,delete_current_page:"删除本页",add_current_page:"添加本页",added_all_page:"已添加全部",added_current_page:"已添加本页",delete_all_page:"删除全部",add_all_page:"添加全部",from_list_title:"待选列表",to_list_title:"已选列表",search_text:"搜索",search_input_class:"input-max search-query",pagination:{paginationULClass:"page_nav",preAllClass:"pre-all",preOneClass:"pre-one",nextOneClass:"next-one",nextAllClass:"next-all",isSameDisabled:!0,disabledClassDashline:"_",disabledClass:"disabled",paginationTextArr:["<<","<",">",">>"],paginationSelectContainerClass:"page_numa"}},a)},this.initListStatusHash=function(){this.listStatusHash={},this.toListStatusHash={},this.searchListStatusHash={},this.toSearchListStatusHash={},_.each(a.from_list,function(b){var d=b[a.itemId];c.listStatusHash[d]=b}),_.each(a.to_list,function(b){var d=b[a.itemId];c.toListStatusHash[d]=b}),_.each(c.listStatusHash,function(b,d){c.toListStatusHash.hasOwnProperty(d)&&(b.status=!0),b.statusText=b.status===!0?a.status_text_2:a.status_text_1,b.statusClass=b.status===!0?a.status_class_2:a.status_class_1})},this.render=function(){this.renderTemplate(),this._renderList(!1,!0),this._renderList(!0,!0)},this.renderTemplate=function(){if(a.template){var c=_.template(a.template,a);b.html(c)}this.$fromContainer=$(".from_list_container"),this.$toContainer=$(".to_list_container"),this.$search=this.$fromContainer.find(".search-query"),this.$toSearch=this.$toContainer.find(".search-query"),this.$fromList=$(".from_list"),this.$toList=$(".to_list"),this.$fromPagination=this.$fromContainer.find(".pagination"),this.$toPagination=this.$toContainer.find(".pagination"),this.$toggleAll=this.$fromContainer.find(".toggle_all_page"),this.$togglePage=this.$fromContainer.find(".toggle_current_page"),this.$deleteAll=this.$toContainer.find(".delete_all_page"),this.$deletePage=this.$toContainer.find(".delete_current_page")},this.spliceListHashByCountAndPage=function(b,c){c=c||1;var d=[];if(_.isObject(b)===!0){var e=(c-1)*a.page_count,f=a.page_count*c;d=_.values(b).slice(e,f)}return d},this.renderList=function(b,c,d){b.children().remove();var e=["<% _.each(list,function(item){ %>",'<li data-id="<%= item[itemId] %>">','<span title="<%= item[itemText] %>"> <%= context.highLightSearchKeyWord(item[itemText], context.dealWithKeyWord(isTo)) %></span>','<span class="status_action ',d?'icon-trash" style="margin-top:12px" >':'<%= item.statusClass %>" >',d?"":"<%= item.statusText %>","</span>","</li>","<% }); %>"].join(""),f=_.template(e,{isTo:d,context:this,list:c,itemText:a.itemText,itemId:a.itemId});b.html(f)},this.renderPagination=function(b,c,d,e){var f=_.keys(c).length,g=_.extend(a.pagination,{count:f,current:d||1,page_count:a.page_count,callback:_.bind(this.selectChangeFunc,{list:c,isTo:e})});b.pagination(g)},this.dealWithKeyWord=function(a){var b=a?this.$toSearch.val():this.$search.val();return b?(b=$.trim(b),b=b.replace(/\s+/," ")):b=" ",b},this._renderList=function(b,d,e){var f=null,g=null,h={},i=1;b?(f=this.$toList,g=this.$toPagination,h=c.toListStatusHash):(f=this.$fromList,g=this.$fromPagination,h=c.listStatusHash),$select=g.$select,$select&&(i=parseInt($select.val(),10));var j=this.dealWithKeyWord(b);" "!==j&&(h=b?this.toSearchListStatusHash:this.searchListStatusHash),_.isObject(e)&&_.keys(e).length&&(h=e);for(var k=this.spliceListHashByCountAndPage(h,i);0===k.length&&i>0;)i--,k=this.spliceListHashByCountAndPage(h,i);if(this.renderList(f,k,b),b)k.length?(this.$deleteAll.removeClass("status_class_2").addClass("status_class_1"),this.$deletePage.removeClass("status_class_2").addClass("status_class_1")):(this.$deleteAll.removeClass("status_class_1").addClass("status_class_2"),this.$deletePage.removeClass("status_class_1").addClass("status_class_2"));else{var l=!1,m=!1;_.each(k,function(a){a.status!==!0&&(l=!0)});var n=" "===j?c.listStatusHash:c.searchListStatusHash;for(var o in n)if(n.hasOwnProperty(o)&&n[o].status!==!0){m=!0;break}l?this.$togglePage.text(a.add_current_page).removeClass("status_class_2").addClass("status_class_1"):this.$togglePage.text(a.added_current_page).removeClass("status_class_1").addClass("status_class_2"),m?this.$toggleAll.text(a.add_all_page).removeClass("status_class_2").addClass("status_class_1"):this.$toggleAll.text(a.added_all_page).removeClass("status_class_1").addClass("status_class_2")}$select&&(g.options.current=i),d&&this.renderPagination(g,h,i,b)},this.bindEvents=function(){this.$fromList.on("click","li span.status_action",_.bind(this.from2To,this)),this.$toList.on("click","li span.status_action",_.bind(this.to2From,this)),this.$fromPagination.on("change","select.pagination-select",this.selectChangeFunc),this.$toPagination.on("change","select.pagination-select",_.bind(this.selectChangeFunc,{isTo:!0})),this.$fromContainer.on("keyup","input.search-query",_.bind(this.filterListStatusHash,{list:this.listStatusHash,$list:this.$fromList})),this.$toContainer.on("keyup","input.search-query",_.bind(this.filterListStatusHash,{list:this.toListStatusHash,$list:this.$toList,isTo:!0})),this.$fromContainer.on("click","i.sort-query",_.bind(this.sortListStatusHash,{$list:this.$fromList})),this.$toContainer.on("click","i.sort-query",_.bind(this.sortListStatusHash,{$list:this.$toList,isTo:!0})),this.$toggleAll.click(_.bind(this.fromAll2To,_.extend({type:"all"},this))),this.$togglePage.click(_.bind(this.fromAll2To,this)),this.$deleteAll.click(_.bind(this.toAll2From,_.extend({type:"all"},this))),this.$deletePage.click(_.bind(this.toAll2From,this))},this.selectChangeFunc=function(){c._renderList(this.isTo,!1,null,!0)},this.syncFromItemStatus=function(b,c){b&&(c!==!0?(b.status=!1,b.statusClass=a.status_class_1,b.statusText=a.status_text_1):(b.status=!0,b.statusClass=a.status_class_2,b.statusText=a.status_text_2))},this.fromItem2To=function(b,c){var d=this.listStatusHash[b],e=d.status;e===!0?(this.syncFromItemStatus(d),c.text(a.status_text_1),c.removeClass("status_class_2").addClass("status_class_1"),delete this.toListStatusHash[b]):(this.syncFromItemStatus(d,!0),c.text(a.status_text_2),c.removeClass("status_class_1").addClass("status_class_2"),this.toListStatusHash[b]=d)},this.fromAll2To=function(b){var d=$(b.currentTarget),e=d.text(),f="",g="",h=null,i=parseInt(this.$fromPagination.$select.val(),10),j=this.dealWithKeyWord();h=" "!==j?c.searchListStatusHash:c.listStatusHash,"all"===this.type?(f=a.add_all_page,g=a.added_all_page):(f=a.add_current_page,g=a.added_current_page,h=this.spliceListHashByCountAndPage(h,i)),e===f?(_.each(h,function(b){c.syncFromItemStatus(b,!0),c.toListStatusHash[b[a.itemId]]=b}),d.text(g),d.removeClass("status_class_1").addClass("status_class_2")):(_.each(h,function(b){c.syncFromItemStatus(b),delete c.toListStatusHash[b[a.itemId]]}),d.text(f),d.removeClass("status_class_2").addClass("status_class_1")),c._renderList(!0,!0,null,!0),c._renderList(!1,!1,null,!0)},this.from2To=function(a){var b=$(a.currentTarget),d=b.parent(),e=d.data("id");this.fromItem2To(e,b),c._renderList(!0,!0,null,!0),c._renderList(!1,!1,null,!0)},this.toAll2From=function(a){var b=$(a.currentTarget);b.hasClass("status_class_2")||(parseInt(this.$toPagination.$select.val(),10),"all"===this.type?(c.toListStatusHash={},c.toSearchListStatusHash={},_.each(c.listStatusHash,function(a){c.syncFromItemStatus(a)}),_.each(c.searchStatusHash,function(a){c.syncFromItemStatus(a)})):this.$toList.find("li").each(function(){var a=$(this),b=a.data("id"),d=c.listStatusHash[b],e=c.searchListStatusHash[b];delete c.toListStatusHash[b],delete c.toSearchListStatusHash[b],c.syncFromItemStatus(d),c.syncFromItemStatus(e)}),c._renderList(!0,!0,null,!0),c._renderList(!1,!1,null,!0))},this.to2From=function(a){var b=$(a.currentTarget),d=b.parent(),e=d.data("id"),f=this.listStatusHash[e],g=this.searchListStatusHash[e];delete this.toListStatusHash[e],delete this.toSearchListStatusHash[e],this.syncFromItemStatus(f),this.syncFromItemStatus(g),c._renderList(!0,!0,null,!0),c._renderList(!1,!1,null,!0)},this.highLightSearchKeyWord=function(a,b){var c="";if(" "===b)return c=a;var d=b.split(" "),e="";_.each(d,function(a){e+=e?"|(?!<[^>]*)("+a+")(?![^<]*>)":"(?!<[^>]*)("+a+")(?![^<]*>)"});var f=new RegExp(e,"ig");return c=a.replace(f,function(a){return'<strong class="keyword">'+a+"</strong>"})},this.filterListStatusHash=function(b){var d=$(b.currentTarget),e=this,f={};c.timer&&clearTimeout(c.timer),c.timer=setTimeout(function(){var b=d.val();b=b?b.replace(/\s+/," "):" "," "!=b?(_.map(e.list,function(c,d){var e=!0,g=c[a.itemText],h=b.split(" ");_.each(h,function(a){-1===g.indexOf(a)&&(e=!1)}),e&&(f[d]=c)}),e.isTo?c.toSearchListStatusHash=f:c.searchListStatusHash=f):e.isTo?c.toSearchListStatusHash=e.list:c.searchListStatusHash=e.list,c._renderList(e.isTo,!0,f,!0)},800)},this.sortListStatusHash=function(a){var b=$(a.currentTarget),d=b.data("sort"),e={},f=c.dealWithKeyWord();e=this.isTo?" "!==f?c.toSearchListStatusHash:c.toListStatusHash:" "!==f?c.searchListStatusHash:c.listStatusHash;var g={},h=[];h=_.keys(e).sort(function(a,b){var c=1;return c=a.length>b.length?1:a.length===b.length?a>=b?1:-1:-1}),"asc"===d?(b.data("sort","desc"),b.addClass("icon-upload").removeClass("icon-download"),h=h.reverse()):(b.data("sort","asc"),b.addClass("icon-download").removeClass("icon-upload")),_.each(h,function(a){g[a]=e[a]}),this.isTo?" "===f?c.toListStatusHash=g:c.toSearchListStatusHash=g:" "===f?c.listStatusHash=g:c.searchListStatusHash=g,c._renderList(this.isTo,!1,g,!0)},this.initialize(),this}}),function(a){"function"==typeof define?define("thirdparty/backbone.js",[],a):"undefined"!=typeof exports?a(require,exports):a()}(function(a,b){var c=this._,d=this.jQuery;this._=a("underscore"),this.jQuery=a("jquery"),function(){var c,d=this,e=d.Backbone,f=[],g=f.push,h=f.slice,i=f.splice;c="undefined"!=typeof b?b:d.Backbone={},c.VERSION="1.0.0";var j=d._;j||"undefined"==typeof a||(j=a("underscore")),c.$=d.jQuery||d.Zepto||d.ender||d.$,c.noConflict=function(){return d.Backbone=e,this},c.emulateHTTP=!1,c.emulateJSON=!1;var k=c.Events={on:function(a,b,c){if(!m(this,"on",a,[b,c])||!b)return this;this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,c){if(!m(this,"once",a,[b,c])||!b)return this;var d=this,e=j.once(function(){d.off(a,e),b.apply(this,arguments)});return e._callback=b,this.on(a,e,c)},off:function(a,b,c){var d,e,f,g,h,i,k,l;if(!this._events||!m(this,"off",a,[b,c]))return this;if(!a&&!b&&!c)return this._events={},this;for(g=a?[a]:j.keys(this._events),h=0,i=g.length;i>h;h++)if(a=g[h],f=this._events[a]){if(this._events[a]=d=[],b||c)for(k=0,l=f.length;l>k;k++)e=f[k],(b&&b!==e.callback&&b!==e.callback._callback||c&&c!==e.context)&&d.push(e);d.length||delete this._events[a]}return this},trigger:function(a){if(!this._events)return this;var b=h.call(arguments,1);if(!m(this,"trigger",a,b))return this;var c=this._events[a],d=this._events.all;return c&&n(c,b),d&&n(d,arguments),this},stopListening:function(a,b,c){var d=this._listeners;if(!d)return this;var e=!b&&!c;"object"==typeof b&&(c=this),a&&((d={})[a._listenerId]=a);for(var f in d)d[f].off(b,c,this),e&&delete this._listeners[f];return this}},l=/\s+/,m=function(a,b,c,d){if(!c)return!0;if("object"==typeof c){for(var e in c)a[b].apply(a,[e,c[e]].concat(d));return!1}if(l.test(c)){for(var f=c.split(l),g=0,h=f.length;h>g;g++)a[b].apply(a,[f[g]].concat(d));return!1}return!0},n=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b)}},o={listenTo:"on",listenToOnce:"once"};j.each(o,function(a,b){k[b]=function(b,c,d){var e=this._listeners||(this._listeners={}),f=b._listenerId||(b._listenerId=j.uniqueId("l"));return e[f]=b,"object"==typeof c&&(d=this),b[a](c,d,this),this}}),k.bind=k.on,k.unbind=k.off,j.extend(c,k);var p=c.Model=function(a,b){var c,d=a||{};b||(b={}),this.cid=j.uniqueId("c"),this.attributes={},j.extend(this,j.pick(b,q)),b.parse&&(d=this.parse(d,b)||{}),(c=j.result(this,"defaults"))&&(d=j.defaults({},d,c)),this.set(d,b),this.changed={},this.initialize.apply(this,arguments)},q=["url","urlRoot","collection"];j.extend(p.prototype,k,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(){return j.clone(this.attributes)},sync:function(){return c.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return j.escape(this.get(a))},has:function(a){return null!=this.get(a)},set:function(a,b,c){var d,e,f,g,h,i,k,l;if(null==a)return this;if("object"==typeof a?(e=a,c=b):(e={})[a]=b,c||(c={}),!this._validate(e,c))return!1;f=c.unset,h=c.silent,g=[],i=this._changing,this._changing=!0,i||(this._previousAttributes=j.clone(this.attributes),this.changed={}),l=this.attributes,k=this._previousAttributes,this.idAttribute in e&&(this.id=e[this.idAttribute]);for(d in e)b=e[d],j.isEqual(l[d],b)||g.push(d),j.isEqual(k[d],b)?delete this.changed[d]:this.changed[d]=b,f?delete l[d]:l[d]=b;if(!h){g.length&&(this._pending=!0);for(var m=0,n=g.length;n>m;m++)this.trigger("change:"+g[m],this,l[g[m]],c)}if(i)return this;if(!h)for(;this._pending;)this._pending=!1,this.trigger("change",this,c);return this._pending=!1,this._changing=!1,this},unset:function(a,b){return this.set(a,void 0,j.extend({},b,{unset:!0}))},clear:function(a){var b={};for(var c in this.attributes)b[c]=void 0;return this.set(b,j.extend({},a,{unset:!0}))},hasChanged:function(a){return null==a?!j.isEmpty(this.changed):j.has(this.changed,a)},changedAttributes:function(a){if(!a)return this.hasChanged()?j.clone(this.changed):!1;var b,c=!1,d=this._changing?this._previousAttributes:this.attributes;for(var e in a)j.isEqual(d[e],b=a[e])||((c||(c={}))[e]=b);return c},previous:function(a){return null!=a&&this._previousAttributes?this._previousAttributes[a]:null},previousAttributes:function(){return j.clone(this._previousAttributes)},fetch:function(a){a=a?j.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=this,c=a.success;return a.success=function(d){return b.set(b.parse(d,a),a)?(c&&c(b,d,a),b.trigger("sync",b,d,a),void 0):!1},N(this,a),this.sync("read",this,a)},save:function(a,b,c){var d,e,f,g=this.attributes;if(null==a||"object"==typeof a?(d=a,c=b):(d={})[a]=b,!(!d||c&&c.wait||this.set(d,c)))return!1;if(c=j.extend({validate:!0},c),!this._validate(d,c))return!1;d&&c.wait&&(this.attributes=j.extend({},g,d)),void 0===c.parse&&(c.parse=!0);var h=this,i=c.success;return c.success=function(a){h.attributes=g;var b=h.parse(a,c);return c.wait&&(b=j.extend(d||{},b)),j.isObject(b)&&!h.set(b,c)?!1:(i&&i(h,a,c),h.trigger("sync",h,a,c),void 0)},N(this,c),e=this.isNew()?"create":c.patch?"patch":"update","patch"===e&&(c.attrs=d),f=this.sync(e,this,c),d&&c.wait&&(this.attributes=g),f},destroy:function(a){a=a?j.clone(a):{};var b=this,c=a.success,d=function(){b.trigger("destroy",b,b.collection,a)};if(a.success=function(e){(a.wait||b.isNew())&&d(),c&&c(b,e,a),b.isNew()||b.trigger("sync",b,e,a)},this.isNew())return a.success(),!1;N(this,a);var e=this.sync("delete",this,a);return a.wait||d(),e},url:function(){var a=j.result(this,"urlRoot")||j.result(this.collection,"url")||M();return this.isNew()?a:a+("/"===a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(a){return this._validate({},j.extend(a||{},{validate:!0}))},_validate:function(a,b){if(!b.validate||!this.validate)return!0;a=j.extend({},this.attributes,a);var c=this.validationError=this.validate(a,b)||null;return c?(this.trigger("invalid",this,c,j.extend(b||{},{validationError:c})),!1):!0}});var r=["keys","values","pairs","invert","pick","omit"];j.each(r,function(a){p.prototype[a]=function(){var b=h.call(arguments);return b.unshift(this.attributes),j[a].apply(j,b)}});var s=c.Collection=function(a,b){b||(b={}),b.url&&(this.url=b.url),b.model&&(this.model=b.model),void 0!==b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,j.extend({silent:!0},b))},t={add:!0,remove:!0,merge:!0},u={add:!0,merge:!1,remove:!1};j.extend(s.prototype,k,{model:p,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return c.sync.apply(this,arguments)},add:function(a,b){return this.set(a,j.defaults(b||{},u))},remove:function(a,b){a=j.isArray(a)?a.slice():[a],b||(b={});var c,d,e,f;for(c=0,d=a.length;d>c;c++)f=this.get(a[c]),f&&(delete this._byId[f.id],delete this._byId[f.cid],e=this.indexOf(f),this.models.splice(e,1),this.length--,b.silent||(b.index=e,f.trigger("remove",f,this,b)),this._removeReference(f));return this},set:function(a,b){b=j.defaults(b||{},t),b.parse&&(a=this.parse(a,b)),j.isArray(a)||(a=a?[a]:[]);var c,d,e,f,h,k=b.at,l=this.comparator&&null==k&&b.sort!==!1,m=j.isString(this.comparator)?this.comparator:null,n=[],o=[],p={};for(c=0,d=a.length;d>c;c++)(e=this._prepareModel(a[c],b))&&((f=this.get(e))?(b.remove&&(p[f.cid]=!0),b.merge&&(f.set(e.attributes,b),l&&!h&&f.hasChanged(m)&&(h=!0))):b.add&&(n.push(e),e.on("all",this._onModelEvent,this),this._byId[e.cid]=e,null!=e.id&&(this._byId[e.id]=e)));if(b.remove){for(c=0,d=this.length;d>c;++c)p[(e=this.models[c]).cid]||o.push(e);o.length&&this.remove(o,b)}if(n.length&&(l&&(h=!0),this.length+=n.length,null!=k?i.apply(this.models,[k,0].concat(n)):g.apply(this.models,n)),h&&this.sort({silent:!0}),b.silent)return this;for(c=0,d=n.length;d>c;c++)(e=n[c]).trigger("add",e,this,b);return h&&this.trigger("sort",this,b),this},reset:function(a,b){b||(b={});for(var c=0,d=this.models.length;d>c;c++)this._removeReference(this.models[c]);return b.previousModels=this.models,this._reset(),this.add(a,j.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b),this},push:function(a,b){return a=this._prepareModel(a,b),this.add(a,j.extend({at:this.length},b)),a},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a),b},unshift:function(a,b){return a=this._prepareModel(a,b),this.add(a,j.extend({at:0},b)),a},shift:function(a){var b=this.at(0);return this.remove(b,a),b},slice:function(a,b){return this.models.slice(a,b)},get:function(a){return null==a?void 0:this._byId[null!=a.id?a.id:a.cid||a]},at:function(a){return this.models[a]},where:function(a,b){return j.isEmpty(a)?b?void 0:[]:this[b?"find":"filter"](function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},findWhere:function(a){return this.where(a,!0)},sort:function(a){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return a||(a={}),j.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(j.bind(this.comparator,this)),a.silent||this.trigger("sort",this,a),this},sortedIndex:function(a,b,c){b||(b=this.comparator);var d=j.isFunction(b)?b:function(a){return a.get(b)};return j.sortedIndex(this.models,a,d,c)},pluck:function(a){return j.invoke(this.models,"get",a)},fetch:function(a){a=a?j.clone(a):{},void 0===a.parse&&(a.parse=!0);var b=a.success,c=this;return a.success=function(d){var e=a.reset?"reset":"set";c[e](d,a),b&&b(c,d,a),c.trigger("sync",c,d,a)},N(this,a),this.sync("read",this,a)},create:function(a,b){if(b=b?j.clone(b):{},!(a=this._prepareModel(a,b)))return!1;b.wait||this.add(a,b);var c=this,d=b.success;return b.success=function(e){b.wait&&c.add(a,b),d&&d(a,e,b)},a.save(null,b),a},parse:function(a){return a},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(a,b){if(a instanceof p)return a.collection||(a.collection=this),a;b||(b={}),b.collection=this;var c=new this.model(a,b);return c._validate(a,b)?c:(this.trigger("invalid",this,a,b),!1)},_removeReference:function(a){this===a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"!==a&&"remove"!==a||c===this)&&("destroy"===a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments))}});var v=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"];j.each(v,function(a){s.prototype[a]=function(){var b=h.call(arguments);return b.unshift(this.models),j[a].apply(j,b)}});var w=["groupBy","countBy","sortBy"];j.each(w,function(a){s.prototype[a]=function(b,c){var d=j.isFunction(b)?b:function(a){return a.get(b)};return j[a](this.models,d,c)}});var x=c.View=function(a){this.cid=j.uniqueId("view"),this._configure(a||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},y=/^(\S+)\s*(.*)$/,z=["model","collection","el","id","attributes","className","tagName","events"];j.extend(x.prototype,k,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(a,b){return this.$el&&this.undelegateEvents(),this.$el=a instanceof c.$?a:c.$(a),this.el=this.$el[0],b!==!1&&this.delegateEvents(),this},delegateEvents:function(a){if(!a&&!(a=j.result(this,"events")))return this;this.undelegateEvents();for(var b in a){var c=a[b];if(j.isFunction(c)||(c=this[a[b]]),c){var d=b.match(y),e=d[1],f=d[2];c=j.bind(c,this),e+=".delegateEvents"+this.cid,""===f?this.$el.on(e,c):this.$el.on(e,f,c)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(a){this.options&&(a=j.extend({},j.result(this,"options"),a)),j.extend(this,j.pick(a,z)),this.options=a},_ensureElement:function(){if(this.el)this.setElement(j.result(this,"el"),!1);else{var a=j.extend({},j.result(this,"attributes"));this.id&&(a.id=j.result(this,"id")),this.className&&(a["class"]=j.result(this,"className"));var b=c.$("<"+j.result(this,"tagName")+">").attr(a);this.setElement(b,!1)}}}),c.sync=function(a,b,d){var e=A[a];j.defaults(d||(d={}),{emulateHTTP:c.emulateHTTP,emulateJSON:c.emulateJSON});var f={type:e,dataType:"json"};if(d.url||(f.url=j.result(b,"url")||M()),null!=d.data||!b||"create"!==a&&"update"!==a&&"patch"!==a||(f.contentType="application/json",f.data=JSON.stringify(d.attrs||b.toJSON(d))),d.emulateJSON&&(f.contentType="application/x-www-form-urlencoded",f.data=f.data?{model:f.data}:{}),d.emulateHTTP&&("PUT"===e||"DELETE"===e||"PATCH"===e)){f.type="POST",d.emulateJSON&&(f.data._method=e);var g=d.beforeSend;d.beforeSend=function(a){return a.setRequestHeader("X-HTTP-Method-Override",e),g?g.apply(this,arguments):void 0}}"GET"===f.type||d.emulateJSON||(f.processData=!1),"PATCH"!==f.type||!window.ActiveXObject||window.external&&window.external.msActiveXFilteringEnabled||(f.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var h=d.xhr=c.ajax(j.extend(f,d));return b.trigger("request",b,h,d),h};var A={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};c.ajax=function(){return c.$.ajax.apply(c.$,arguments)};var B=c.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},C=/\((.*?)\)/g,D=/(\(\?)?:\w+/g,E=/\*\w+/g,F=/[\-{}\[\]+?.,\\\^$|#\s]/g;j.extend(B.prototype,k,{initialize:function(){},route:function(a,b,d){j.isRegExp(a)||(a=this._routeToRegExp(a)),j.isFunction(b)&&(d=b,b=""),d||(d=this[b]);var e=this;return c.history.route(a,function(f){var g=e._extractParameters(a,f);d&&d.apply(e,g),e.trigger.apply(e,["route:"+b].concat(g)),e.trigger("route",b,g),c.history.trigger("route",e,b,g)}),this},navigate:function(a,b){return c.history.navigate(a,b),this},_bindRoutes:function(){if(this.routes){this.routes=j.result(this,"routes");for(var a,b=j.keys(this.routes);null!=(a=b.pop());)this.route(a,this.routes[a])}},_routeToRegExp:function(a){return a=a.replace(F,"\\$&").replace(C,"(?:$1)?").replace(D,function(a,b){return b?a:"([^/]+)"}).replace(E,"(.*?)"),new RegExp("^"+a+"$")},_extractParameters:function(a,b){var c=a.exec(b).slice(1);return j.map(c,function(a){return a?decodeURIComponent(a):null})}});var G=c.History=function(){this.handlers=[],j.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},H=/^[#\/]|\s+$/g,I=/^\/+|\/+$/g,J=/msie [\w.]+/,K=/\/$/;G.started=!1,j.extend(G.prototype,k,{interval:50,getHash:function(a){var b=(a||this).location.href.match(/#(.*)$/);return b?b[1]:""},getFragment:function(a,b){if(null==a)if(this._hasPushState||!this._wantsHashChange||b){a=this.location.pathname;var c=this.root.replace(K,"");a.indexOf(c)||(a=a.substr(c.length))}else a=this.getHash();return a.replace(H,"")},start:function(a){if(G.started)throw new Error("Backbone.history has already been started");G.started=!0,this.options=j.extend({},{root:"/"},this.options,a),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var b=this.getFragment(),d=document.documentMode,e=J.exec(navigator.userAgent.toLowerCase())&&(!d||7>=d);this.root=("/"+this.root+"/").replace(I,"/"),e&&this._wantsHashChange&&(this.iframe=c.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(b)),this._hasPushState?c.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!e?c.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=b;var f=this.location,g=f.pathname.replace(/[^\/]$/,"$&/")===this.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!g?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&g&&f.hash&&(this.fragment=this.getHash().replace(H,""),this.history.replaceState({},document.title,this.root+this.fragment+f.search)),this.options.silent?void 0:this.loadUrl())},stop:function(){c.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),G.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})
},checkUrl:function(){var a=this.getFragment();return a===this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe))),a===this.fragment?!1:(this.iframe&&this.navigate(a),this.loadUrl()||this.loadUrl(this.getHash()),void 0)},loadUrl:function(a){var b=this.fragment=this.getFragment(a),c=j.any(this.handlers,function(a){return a.route.test(b)?(a.callback(b),!0):void 0});return c},navigate:function(a,b){if(!G.started)return!1;if(b&&b!==!0||(b={trigger:b}),a=this.getFragment(a||""),this.fragment!==a){this.fragment=a;var c=this.root+a;if(this._hasPushState)this.history[b.replace?"replaceState":"pushState"]({},document.title,c);else{if(!this._wantsHashChange)return this.location.assign(c);this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace))}b.trigger&&this.loadUrl(a)}},_updateHash:function(a,b,c){if(c){var d=a.href.replace(/(javascript:|#).*$/,"");a.replace(d+"#"+b)}else a.hash="#"+b}}),c.history=new G;var L=function(a,b){var c,d=this;c=a&&j.has(a,"constructor")?a.constructor:function(){return d.apply(this,arguments)},j.extend(c,d,b);var e=function(){this.constructor=c};return e.prototype=d.prototype,c.prototype=new e,a&&j.extend(c.prototype,a),c.__super__=d.prototype,c};p.extend=s.extend=B.extend=x.extend=G.extend=L;var M=function(){throw new Error('A "url" property or function must be specified')},N=function(a,b){var c=b.error;b.error=function(d){c&&c(a,d,b),a.trigger("error",a,d,b)}}}.call(this),this._=c,this.jQuery=d});